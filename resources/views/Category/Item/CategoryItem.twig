{% extends getPartial('page-design') %}
{% import "Ceres::PageDesign.Macros.LayoutContainer" as LayoutContainer %}
{% import "Ceres::Category.Macros.CategoryTree" as Tree %}

{% set overrideSearchFilters = LayoutContainer.show("Ceres::Search.Filter", facets ) %}

{% block PageBody %}
	{% set listType = isSearch ? "itemsearch" : "categoryitem" %}
	{% set shopBuilderTemplate = shop_builder_category_template(category.id, listType) %}

	{% if shopBuilderTemplate | trim is not empty or isShopBuilder %}

		<div class="categoriegrid pt-0 page-content container-max">
			<div class="row">
				<div class="col-12">
					{{ shopBuilderTemplate | raw }}
				</div>
			</div>
		</div>

	{% else %}
		{% if category.id == 67611 %}
			<div class="category-heroshot">
				<div class="container-max">
					<div class="row">
						<div class="col-12">
							<h1>JOIN THE TEAM</h1>
							<p>
								Wir packen Dinge gemeinsam an, schenken unseren Mitarbeitern Freiraum
																																																																																																																																																																																																																			        und Vertrauen, leben Proaktivität und treten als Team auf.  Wenn Du dich
																																																																																																																																																																																																																			        in einem familiären Umfeld wohlfühlst, für Garten und E-Commerce
																																																																																																																																																																																																																			        interessierst, dann geh den nächsten Schritt: Schick uns Deine Bewerbung
																																																																																																																																																																																																																			        und lerne uns kennen. Wir freuen uns auf Dich!
							</p>
							<a href="/ueber-uns">
								<button class="btn btn-primary">Lerne über uns</button>
							</a>
						</div>
					</div>
				</div>
			</div>

		{% endif %}
		{% if category is defined and ceresConfig.item.showCategoryImage and category.id != 67611  %}
			{% include "Ceres::Category.Item.Partials.CategoryParallaxImage" with { 'category': category } %}
		{% endif %}

		<div class="categoriegrid page-content">
			<div class="container-max">
				{% if isSearch %}
					<div class="row mt-3">
						<div class="col-12">
							<h1 class="h2">
								{% if isTag %}
									{{ trans("Ceres::Template.tagSearchResults", {"searchString": searchString|replace({'_': " "}) }) }}
								{% else %}
									{{ trans("Ceres::Template.itemSearchResults") }}
									{{ searchString }}
								{% endif %}
							</h1>
						</div>
					</div>
				{% endif %}
				<div class="row mt-3">
					{% if category.id != 67611 %}
						<div class="col-12">
							<h1 class="h2 category-title mt-4 mb-5 text-center">{{ category.details[0].name }}</h1>
						</div>
					{% endif %}

					{% if overrideSearchFilters | trim is empty %}
						<item-filter-list :facet-data="{{ facets | json_encode }}">
							{% if facets | length > 0 %}
								<a class="btn btn-link filter-toggle">
									<i class="fa fa-sliders default-float" aria-hidden="true"></i>
									{{ trans("Ceres::Template.itemFilter") }}
								</a>
							{% endif %}
						</item-filter-list>
					{% else %}
						{{ overrideSearchFilters }}
					{% endif %}
				</div>


				<div class="list-controls mb-5">
					<div class="list-controls-inner p-2">
						<div class="row w-100 d-flex">
							<div class="col-6">
								<div class="itemCount d-none d-sm-block d-md-block d-lg-block d-xl-block">
									<span class="text-muted">{{ itemList | length }}
										von
										{{ itemCountTotal }}
										Artikel
									</span>
								</div>
							</div>
							<div class="col-6">
								<div class="list-wrapper">
									{% include "Ceres::Category.Item.Partials.ItemSorting" with { 'sortingData': searchOptions.sorting, 'selectedSorting': itemSorting } %}
								</div>
							</div>

						</div>

						{# TAGS #}
						<lazy-hydrate when-idle>
							<item-filter-tag-list :facet-data="{{ facets | json_encode }}"></item-filter-tag-list>
						</lazy-hydrate>
					</div>

					{% if ceresConfig.pagination.position in ['top', 'top_bottom'] %}
						<div class="list-controls mb-5 row">
							<div class="col-12">
								<div class="float-right">
									{% include "Ceres::Category.Item.Partials.Pagination" %}
								</div>
							</div>
						</div>
					{% endif %}

					<div class="row">

						{% if category is defined and ceresConfig.header.showNavBars in ["side", "both"] %}
							<div class="col-3 d-none d-lg-block">
								<div class="sidebar-categories">
									<div class="category-title">{{ trans("Ceres::Template.itemCategories") }}</div>
									{{ include('Ceres::PageDesign.Partials.Header.SideNavigation.twig') }}
								</div>

								{{ LayoutContainer.show("Ceres::CategoryItem.SideNavBarBottom") }}
							</div>

						{% endif %}

						<div class="col-12 col-lg-{% if category is defined and ceresConfig.header.showNavBars in [" side", " both"] %}9{% else %}12{% endif %}">
							{% if itemList is not empty %}
								<ul class="{% if category.id == 67611 %}list-unstyled {% else %}product-list {% endif %} row grid">
									{% for item in itemList %}
										{% if category.id != 67611 %}

											<li class="col-12 col-sm-6 col-md-4 col-lg-{% if category is defined and ceresConfig.header.showNavBars in [" side", " both"] %}4{% else %}3{% endif %}">
												<category-item :decimal-count="{{ ceresConfig.item.storeSpecial }}" {% if category.id == 67611 %} template-override="#vue-category-job" {% endif %}>
													<template #before-prices>{{ LayoutContainer.show("Ceres::CategoryItem.BeforePrices", item.data) }}</template>
													<template #after-prices>{{ LayoutContainer.show("Ceres::CategoryItem.AfterPrices", item.data) }}</template>
													<template #item-data>{{ item.data | json_encode }}</template>

													<a href="{{ item.data | itemURL }}" class="small">
														<i class="fa fa-image"></i>
														<span>{{ item.data | itemName }}</span>
													</a>
												</category-item>
											</li>
										{% endif %}
										{% if category.id == 67611 %}
											<li class="category-job col-12">
												{% if category.id == 67611 %}

													<category-jobs :decimal-count="{{ ceresConfig.item.storeSpecial }}" {% if category.id == 67611 %} template-override="#vue-category-job" {% endif %}>
														<template #before-prices>{{ LayoutContainer.show("Ceres::CategoryItem.BeforePrices", item.data) }}</template>
														<template #after-prices>{{ LayoutContainer.show("Ceres::CategoryItem.AfterPrices", item.data) }}</template>
														<template #item-data>{{ item.data | json_encode }}</template>

														<a href="{{ item.data | itemURL }}" class="small">
															<i class="fa fa-image"></i>
															<span>{{ item.data | itemName }}</span>
														</a>

													</category-jobs>
												{% endif %}
											</li>
										{% endif %}
									{% endfor %}

								</ul>
							{% endif %}

							{% if category is not defined and itemList is empty %}
								<p class="h3 text-muted mb-5 text-center">{{ trans("Ceres::Template.itemSearchNoResults", {"searchString": searchString}) }}</p>
							{% endif %}
						</div>
					</div>

					{% if ceresConfig.pagination.position in ['bottom', 'top_bottom'] %}
						<div class="list-controls mb-5 row">
							<div class="col-12">
								<div class="float-right">
									{% include "Ceres::Category.Item.Partials.Pagination" %}
								</div>
							</div>
						</div>
					{% endif %}

					{% if category is defined %}
						<div class="col-12">
							{% if ceresConfig.item.showCategoryDescriptionBottom in ["description1", "both"] and category.details[0].description | trim is not empty %}
								<div class="category-description mb-3">{{ category.details[0].description | raw }}</div>
							{% endif %}
							{% if ceresConfig.item.showCategoryDescriptionBottom in ["description2", "both"] and category.details[0].description2 | trim is not empty %}
								<div class="category-description mb-3">{{ category.details[0].description2 | raw }}</div>
							{% endif %}
						</div>
					{% endif %}
				</div>
			</div>
		{% endif %}

	{% endblock %}

	{% block PartialHead %}
		{% set canonicalUrl = services.url.getCanonicalURL(null, true) %}

		{% if currentPage == 2 %}
			<link rel="prev" href="{{ canonicalUrl ~ queryString({'page': null}) }}"/>
		{% elseif currentPage > 2 %}
			<link rel="prev" href="{{ canonicalUrl ~ queryString({'page': currentPage - 1}) }}"/>
		{% endif %}

		{% if currentPage + 1 <= pageMax %}
			<link rel="next" href="{{ canonicalUrl ~ queryString({'page': currentPage + 1}) }}"/>
		{% endif %}

		{% if category is null %}
			{% if '&' in queryString() %}
				{% set robotsValue = 'NOINDEX' %}
			{% else %}
				{% set robotsValue = ceresConfig.meta.robotsSearchResult %}
			{% endif %}

			{% embed getPartial('page-metadata') %}
				{% block title      trans("Ceres::Template.itemSearchResults") ~ " " ~ searchString %}
				{% block robots     robotsValue %}
			{% endembed %}
		{% else %}
			{% embed getPartial('page-metadata') %}{% endembed %}
		{% endif %}
	{% endblock %}
